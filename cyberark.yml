    - name: Authenticate to CyberArk Web Services
      cyberark_authentication:
        api_base_url: "https://pvwa.192.168.3.102.xip.io"
        validate_certs: no
        username: "{{ cyberark_rest_user }}"
        password: "{{ cyberark_rest_pass }}"

    - name: Set CyberArk Authn Token to Fact Named cyberark_authn_token
      set_fact:
        cyberark_authn_token: "{{ cyberark_session.token }}"
      no_log: yes

    - name: Onboard MySQL Local User to CyberArk EPV
      uri:
        url: https://pvwa.192.168.3.102.xip.io/PasswordVault/api/Accounts/
        headers:
          Content-Type: application/json
          Authorization: "{{ cyberark_authn_token }}"
        method: POST 
        status_code: 201
        body:
          name: "MYSQL-DEMO-USER"
          address: "rhel01.192.168.3.104.xip.io"
          userName: "{{ mysql_username }}"
          platformId: "MySQL"
          safeName: "D-MYSQL-LOCAL-USERS"
          secretType: "password"
          secret: "{{ mysql_password }}"
          secretManagement:
            automaticManagementEnabled: yes
        body_format: json
        validate_certs: no

    - name: Logoff from CyberArk Web Services
      cyberark_authentication:
        state: absent 
        cyberark_session: "{{ cyberark_session }}"
